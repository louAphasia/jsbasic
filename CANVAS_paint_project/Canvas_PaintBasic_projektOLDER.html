<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OLD PL  MMH ELOQUENT paint basic app </title>
</head>
<body>
<script>
    //tworzenie modelu DOM
    function elt(name,attributes){
        var node=document.createElement(name);
        if(attributes){
            for(var attr in attributes)
                if(attributes.hasOwnProperty(attr))
                    node.setAttribute(attr,attributes[attr]);
        }
        for(var i=2;i<arguments.length;i++) {
            var child = arguments[i];
            if (typeof child == "string")
                child = document.createTextNode(child);
        node.appendChild(child)
        }
        return node;
        }
//podstawa core programu funkcja createPaint
    var controls=Object.create(null);
    function createPaint(parent){
        var canvas=elt("canvas",{width:500,height:300});
        var cx=canvas.getContext("2d");
        var toolbar=elt("div",{class:"toolbar"});
        for(var name in controls)
            toolbar.appendChild(controls[name](cx));

        var panel=elt("div",{class:"picturepanel"}, canvas);
    parent.appendChild(elt("div",null,panel,toolbar));
    }
    //wybor narzedzi tools
    var tools=Object.create(null);

    controls.tool=function (cx) {
        var select=elt("select");
        for(var name in tools)
        select.appendChild(elt("option",null,name));

        cx.canvas.addEventListener("mousedown",function(event){
            if(event.which==1){
                tools[select.value](event,cx)
                event.preventDefault();
            }
        });
        return elt("span",null,"Narzedzie",select)
    };
    function relativePos(event,element){
        var rect=element.getBoundingClientRect();
        return {x:Math.floor(event.clientX-rect.left),
                y:Math.floor((event.clientY-rect.top))}
    };
    function trackDrag(onMove,onEnd) {
        function end(event) {
        }
            removeEventListener("mousemove", onMove);
            removeEventListener("mouseup", end);
        }
        tools.Linia=function (event,cx,onEnd) {
            cx.lineCap="round";

            var pos=relativePos(event,cx.canvas);
            trackDrag(function(event){
                cx.beginPath();
                cx.moveTo(pos.x,pos.y);
                pos=relativePos(event,cx.canvas)
                cx.lineTo(pos.x,pos.y);
                cx.stroke();
            },onEnd);
        };
    tools.Gumka=function (event,cx) {
        cx.globalCompositeOperation="destination-out";
        tools.Linia(event,cx,function () {
cx.globalCompositeOperation="source-over";
        });
    };
    //KOLOR I ROZMIAR PEDZLA
    controls.color=function (cx) {
        var input=elt("input",{type:"color"});
        input.addEventListener("change",function () {
            cx.fillStyle=input.value;
            cx.strokeStyle=input.value;
        })
        return elt("span",null,"Kolor: ", input)
    };
    controls.brushSize=function (cx) {
var select=elt("select");
var sizes=[1,2,3,5,8,12,25,35,50,75,100];
sizes.forEach(function (size) {
    select.appendChild(elt("option",{value:size}, size+"px"));
});
select.addEventListener("change",function () {
    cx.lineWidth=select.value;
});
return elt("span", null, "Rozmiar pedzla : ", select);
    };
    //ZAPISYWANIE..
    //ADRESY URL DANYCH protokol data:
    controls.save=function (cx) {
        var link=elt("a",{href:"/"},"Zapisz");
        function update(){
            try{
                link.href=cx.canvas.toDataURL();
            }catch (e) {
                if(e instanceof SecurityError)
                    link.href="javascript:alert("+JSON.stringify("Nie mozna zapisac: "+ e.toString())+ ")";
        else throw e;   }
        }
        link.addEventListener("mouseover",update);
        link.addEventListener("focus",update);
        return link;
    };
    //wczytanie obrazow z plikow
</script>
</body>
</html>